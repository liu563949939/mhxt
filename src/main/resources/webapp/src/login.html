<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="assets/css/layui.css">
    <link rel="stylesheet" href="assets/css/login.css">
    <link rel="icon" href="/favicon.ico">
    <title>管理后台</title>
</head>

<body class="login-wrap">
    <div class="login-container">
        <form class="login-form">
            <div class="input-group">
                <input type="text" id="username" class="input-field">
                <label for="username" class="input-label">
                    <span class="label-title">用户名</span>
                </label>
            </div>
            <div class="input-group">
                <input type="password" id="password" class="input-field">
                <label for="password" class="input-label">
                    <span class="label-title">密码</span>
                </label>
            </div>
            <button type="button" id="login" class="login-button">登录<i class="ai ai-enter"></i></button>
        </form>
    </div>
</body>
<script src="assets/layui.js"></script>
<script src="index.js" data-main="login"></script>

<script>
    //自定义
    layui.use(["layer", "table", "jquery", "form", 'core', 'exd'], function () {
        var $ = layui.jquery,
            global = layui.global,
            layer = layui.layer;

        //用户登陆
        $('#login').on('click', function () {
            var localTest = layui.sessionData('login');
            //1.变量定义
            var username = $('#username').val();
            var password = $('#password').val();
            //2.用户校验
            var param = {};
            param.url = 'user/findByName',
                param.condition = { username: username, password: password },
                param.type = 'dic',
                param.callback = function (sParam) {
                    var data = sParam.data;
                    if (data.length == 1) {
                        debugger
                        var userId = data[0].jlbh,
                            unitCode = data[0].unitCode,
                            name = data[0].name;
                        //session赋值
                        layui.sessionData('login', {
                            key: 'userInfo',
                            value: [
                                {userId: userId},
                                {unitCode: unitCode},
                                {name: name}
                            ]
                        });
                        //2.页面跳转
                        window.location.href = "./index.html";
                    } else {
                        layer.msg('用户名或密码错误！');
                    }

                }
            global.commonQuery(param)
        })
    })
</script>


</html>